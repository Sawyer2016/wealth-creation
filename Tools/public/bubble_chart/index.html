<!DOCTYPE html>
<html>
    <head>
        <title>Bubble chart test</title>
        <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.0/moment.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="bubble_chart.js"></script>
    </head>
    <body>
        <div id="bubble"></div>
        <div id="date-picker">
            <h1>Pick a date to view debt progress on that day</h1>
            <select id="picker"></select>
        </div>

        <script>
            var testData = {
                'debts': [
                    {
                        'addDate': '2016-09-21',
                        'totalBalance': 10,
                        'recurringPayment': 5,
                        'payOffPeriod': 'monthly',
                        'name': 'Test Debt',
                        'description': 'Not a real debt',
                        'payments': []
                    },
                    {
                        'addDate': '2016-09-24',
                        'totalBalance': 100,
                        'recurringPayment': 20,
                        'payOffPeriod': 'monthly',
                        'name': 'A different debt',
                        'description': 'Also not real',
                        'payments': [
                            {
                                'paymentDate': '2016-09-25',
                                'paymentAmount': 20
                            }
                        ]
                    },
                    {
                        'addDate': '2016-09-24',
                        'totalBalance': 100,
                        'recurringPayment': 50,
                        'payOffPeriod': 'monthly',
                        'name': 'My House',
                        'description': 'Also not real',
                        'payments': [
                            {
                                'paymentDate': '2016-09-25',
                                'paymentAmount': 20
                            },
                            {
                                'paymentDate': '2016-09-26',
                                'paymentAmount': 30
                            },    
                        ]
                    }
                ]
            }

            var chart = new BubbleChart('bubble', 800, 800, '#ff00ff');
            chart.init()
            
            chart.setData(testData.debts);
            // chart.setDate('2016-09-20');

        //     function generatePlan(planDate, debts) {
        //         var includedDebts = debtsOnOrBefore(planDate, debts);
                
        //         setPriorities(includedDebts);
        //         setPayOffDates(includedDebts);

        //         setPercentBalance(planDate, includedDebts);
        //         setPercentTime(planDate, includedDebts);

        //         return includedDebts;
        //     }

        //     function setPriorities(debts) {
        //         // Sort so lowest divison is first, according to debt plan
        //         // this is highest priority
        //         var sorted = $(debts).sort(function (a, b) {return (a.totalBalance / a.recurringPayment) > (b.totalBalance / b.recurringPayment);});

        //         // Set Priorities
        //         for (var i = 0; i < sorted.length; i++) {
        //             var debt = sorted[i];
        //             debt.priority = i + 1;
        //         }

        //         return debts;
        //     }

        //    function setPayOffDates(debts) {
        //         // TODO: Calculate accumulated payment
        //         var paymentFromPreviousDebts = 0;

        //         // Calculate for priority #1 separately, it works differently
        //         debts[0].payOffDate = calculatePayOffDate(debts[0].recurringPayment * 1.1 + paymentFromPreviousDebts, debts[0].totalBalance, debts[0].addDate, debts[0].payOffPeriod);

        //         for (var i = 1; i < debts.length; i++) {
        //             var debt = debts[i];
        //             debt.payOffDate = calculatePayOffDate(debt.recurringPayment + paymentFromPreviousDebts, debt.totalBalance, debt.addDate, debt.payOffPeriod);
        //         }

        //         return debts;
        //     }

        //     function calculatePayOffDate(amount, total, addDate, periodicity) {
        //         var periods = 0;
        //         var runningTotal = amount;

        //         while (runningTotal < total) {
        //             periods += 1;
        //             runningTotal += amount;
        //         }

        //         var momentdict = {
        //             'monthly': 'months',
        //             'weekly': 'weeks'
        //         }

        //         return moment(addDate).add(periods, momentdict[periodicity]).format("YYYY-MM-DD");
        //     }

        //     function setPercentBalance(planDate, debts) {
        //         for (var i = 0; i < debts.length; i++) {
        //             var debt = debts[i];

        //             var totalPaid = debt.payments.map(function(payment) {return payment.paymentAmount;}).reduce(function(pre, cur) {return pre + cur;}, 0);
        //             debt.percentBalance = 100.0 * totalPaid / debt.totalBalance;
        //         }
        //     }

        //     function setPercentTime(planDate, debts) {
        //         for (var i = 0; i < debts.length; i++) {
        //             var debt = debts[i];

        //             var startTime = moment(debt.addDate);
        //             var elapsedTime = moment(planDate).diff(startTime);
        //             var endTime = moment(debt.payOffDate).diff(startTime);

        //             debt.percentTime = 100.0 * (elapsedTime / endTime);
        //         }
        //     }

        //     function debtsOnOrBefore(planDate, debts) {
        //         var res = [];

        //         for (var d = 0; d < debts.length; d++) {
        //             var debt = debts[d];
        //             if (moment(planDate).diff(moment(debt.addDate)) >= 0) {
        //                 res.push(debt);
        //             }
        //         }

        //         return jQuery.extend(true, [], res);
        //     }

            // console.log(generatePlan('2016-10-21', testData.debts));
            
            // var chart = new BubbleChart('bubble', 800, 800, '#ff00ff');
            // chart.init()

    //         	$.ajax({
	// 	url: "http://4000v-cis-swen90014-wcplatypus-l.eng.unimelb.edu.au/tools/debtPlan/renderPlan",
	// 	success: function(data) {
	// 		chart.setData(data);
	// 		chart.setDate(Object.keys(data)[0]);
	// 	}
	// });

    //         var data = {"2016-09-20":[{"startDate":"2016-09-20","payOffDate":'2016-09-30',"totalBalance":1000,"recurringPayment":100,"totalPaid":100,"payOffPeriod":"monthly","priority":-1,"name":"Car"}]};
    //         var data2 = {
    //             '2016-09-12': [
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-09-30',
    //                     'totalBalance': 5000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 1000,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 1,
    //                     'name': 'Car',
    //                 },
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-10-30',
    //                     'totalBalance': 10000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 4000,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 2,
    //                     'name': 'House',
    //                 },
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-12-31',
    //                     'totalBalance': 20000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 0,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 3,
    //                     'name': 'Truck',
    //                 },
    //             ],
    //             '2016-09-13': [
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-09-30',
    //                     'totalBalance': 5000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 3000,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 1,
    //                     'name': 'Car',
    //                 },
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-10-30',
    //                     'totalBalance': 10000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 4000,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 2,
    //                     'name': 'House',
    //                 },
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-12-31',
    //                     'totalBalance': 20000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 0,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 3,
    //                     'name': 'Truck',
    //                 },
    //             ],
    //             '2016-09-14': [
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-09-30',
    //                     'totalBalance': 5000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 4000,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 1,
    //                     'name': 'Car',
    //                 },
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-10-30',
    //                     'totalBalance': 10000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 6000,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 2,
    //                     'name': 'House',
    //                 },
    //                 {
    //                     'startDate': '2016-09-01',
    //                     'payOffDate': '2016-12-31',
    //                     'totalBalance': 20000,
    //                     'recurringPayment': 300,
    //                     'totalPaid': 1000,
    //                     'payOffPeriod': 'monthly',
    //                     'priority': 3,
    //                     'name': 'Truck',
    //                 },
    //             ],
    //         }

    //         // chart.setData(data);
    //         // chart.setDate('2016-09-20');

    //         for (key in data) {
    //             $('#picker').append($('<option>', {
    //                 value: key,
    //                 text: key
    //             }));
    //         }

    //         $('#picker').on('change', function() {
    //             chart.setDateAnim(this.value);
    //         });
        </script>
    </body>
</html>